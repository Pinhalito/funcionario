#!/bin/bash
#######################
#    ^...^  `^...^¬¥   #
#   / o,o \ / O,O \   #
#   |):::(| |):::(|   #
# ====" "=====" "==== #
#         TdC         #
#      1998-2022      #
#######################
# Toca das Corujas
# C√≥digos Bin√°rios, Fun√ß√µes de Onda e Teoria do Orbital Molecular Inc.
# Unidade Bar√£o Geraldo CX
#2022_06_24_20_15_58

#############################################
#Script para baixar chats de lives do Youtube
#
#Requisitos:
#
#xclip
#pip3
#chat_downloader
#############################################

#Pega a √°rea de transfer√™ncia
url=$(xclip -selection c -o)


#Checa se √© uma url v√°lida
if  [[ $url != http* ]];
then
zenity --error --text "Url do Youtube inv√°lida"
else


#Prepara√ß√£o
cd "$HOME/CHATS" || return
chatdata=$(date +%Y%m%d_%H%M)
mkdir "$chatdata"
chmod 777 -R "$chatdata"
cd "$chatdata" || return


#Separa a id do v√≠deo
ide=${url#*=}


#Pega o t√≠tulo do v√≠deo e filtra
titulo=$(wget -qO- "$url" | perl -l -0777 -ne 'print $1 if /<title.*?>\s*(.*?)(?: - youtube)?\s*<\/title/si')

titulo=$(echo "$titulo" | tr ' ' '_' | iconv -t 'ascii//TRANSLIT')

titulo=${titulo//[^[:alnum:]]/}_"$ide"


#Chat
chat_downloader "$url" --message_groups "messages superchat" --output "$titulo".json 2>&1 | tee "$titulo".txt

zenity --info --text "Chat baixado"


#Verifica se h√° o replay ou apaga
if grep -q "Video does not have a chat replay" "$titulo.txt"; then
rm -rf "$titulo.txt"
rmdir /"$HOME"/CHATS/"$chatdata" 
zenity --info --text "V√≠deo sem chat"
fi

#Limpa emotes
arquivo="$titulo.json"
if [[ -f "$arquivo" ]]; then
zenity --info --text "Limpando emotes"
while
read -r A B;
do
sed -i "s/${A}/${B}/g" "$titulo".txt;
sed -i "s/${A}/${B}/g" "$titulo".json;
done<<EOF
:alien: üëΩ
:ambulance: üöë
:angry_face: üò†
:astonished_face: üò≤
:baby: üë∂
:baby_bottle: üçº
:backhand_index_pointing_left: üëà
:backhand_index_pointing_right: üëâ
:balloon: üéà
:battery: üîã
:beaming_face_with_smiling_eyes: üòÅ
:beer_mug: üç∫
:bell: üîî
:beverage_box: üßÉ
:blue_heart: üíô
:bomb: üí£
:bouquet: üíê
:boxing_glove: ü•ä
:boy: üë¶
:brain: üß†
:buffering: ‚åõ
:bus: üöå
:call_me_hand: ü§ô
:camera: üì∑
:castle: üè∞
:cat_with_tears_of_joy: üòπ
:chicken: üêî
:cigarette: üö¨
:clap: üëè
:clapping_hands: üëè
:clipboard: üìã
:clown_face: ü§°
:coffin: ‚ö∞
:cold_face: ü•∂
:collision: üí•
:confused_face: üòï
:construction: üöß
:cookie: üç™
:cow: üêÇ
:cow: üêÑ
:crab: ü¶Ä
:dashing_away: üí®
:deciduous_tree: üå≥
:disappointed_face: üòû
:disguised_face: ü•∏
:dog: üêï
:dog2: ‚úñÔ∏è
:dog2: üêï
:dothefive: 5Ô∏è‚É£
:dothefive: 5Ô∏è‚É£
:double_exclamation_mark: ‚Äº
:double_exclamation_mark: ‚Äº
:drooling_face: ü§§
:earth_africa: üåç
:earth_americas: üåé
:eggplant: üçÜ
:elbowcough: üí™
:exclamation_question_mark: ‚Åâ
:exploding_head: ü§Ø
:expressionless_face: üòë
:eye: üëÅ
:eyes: üëÄ
:face_blowing_a_kiss: üòò
:face_savoring_food: üòã
:face_screaming_in_fear: üò±
:face_vomiting: ü§Æ
:face_with_hand_over_mouth: ü§≠
:face_with_monocle: üßê
:face_with_open_mouth: üòÆ
:face_without_mouth: üò∂
:face_with_raised_eyebrow: ü§®
:face_with_rolling_eyes: üôÑ
:face_with_spiral_eyes: üòµ‚Äçüí´
:face_with_tears_of_joy: üòÇ
:face_with_tongue: üòõ
:fire: üî•
:fish: üêü
:flexed_biceps: üí™
:flushed_face: üò≥
:folded_hands: üôè
:frog: üê∏
:full_moon_face: üåù
:garlic: üßÑ
:ghost: üëª
:glass_of_milk: ü•õ
:globe_showing_americas: üåé
:globe_showing_asia_australia: üåè
:globe_showing_europe_africa: üåç
:goat: üêê
:goodvibes: ‚úåÔ∏è
:grimacing_face: üò¨
:grinning_face: üòÄ
:grinning_face_with_big_eyes: üòÉ
:grinning_face_with_smiling_eyes: ‚úñÔ∏è
:grinning_face_with_smiling_eyes: üòÅ
:grinning_face_with_sweat: üòÖ
:grinning_squinting_face: üòÜ
:handshake: ü§ù
:hand_with_fingers_splayed: üñê
:heart_on_fire: ‚ù§‚Äçüî•
:herb: üåø
:hibiscus: üå∫
:horse: üêé
:house_with_garden: üè°
:hugging_face: ü§ó
:hushed_face: üòØ
:hydrate: üí©
:kiss: üíã
:kissing_face_with_closed_eyes: üòö
:knocked_out_face: üòµ
:left_facing_fist: ü§õ
:leopard: üêÜ
:lollipop: üç≠
:loudly_crying_face: üò≠
:loudspeaker: üì¢
:lying_face: ü§•
:magnifying_glass_tilted_right: üîé
:man_facepalming: ü§¶‚Äç‚ôÇ
:man_shrugging: ü§∑‚Äç‚ôÇ
:man_swimming: üèä‚Äç‚ôÇ
:man_zombie: üßü‚Äç‚ôÇ
:microphone: üé§
:middle_finger: üñï
:money_mouth_face: ü§ë
:money_with_wings: üí∏
:mouth: üëÑ
:movie_camera: üé•
:multiply: ‚úñÔ∏è
:musical_note: üéµ
:musical_notes: üé∂
:musical_score: üéº
:national_park: üèû
:nerd_face: ü§ì
:neutral_face: üòê
:night_with_stars: üåÉ
:office_building: üè¢
:oncoming_fist: üëä
:oops: ü§≠
:oops: ‚úñÔ∏è
:open_hands: üëê
:ox: üêÇ
:partying_face: ‚úñÔ∏è
:partying_face: üí©
:pear: üçê
:pensive_face: üòî
:person_facepalming: ü§¶
:person_fencing: ü§∫
:person_gesturing_ok: üôÜ
:person_raising_hand: üôã
:person_running: üèÉ
:person_shrugging: ü§∑
:person_swimming: üèä
:person_taking_bath: üõÄ
:petri_dish: üß´
:pig: üê∑
:pile_of_poo: üí©
:pill: üíä
:pizza: üçï
:point_left: üëà
:point_right: üëâ
:poodle: üê©
:popcorn: üçø
:potato: ü•î
:pouting_face: üò°
:prohibited: üö´
:purple_heart: üíú
:racehorse: üêé
:radio: üìª
:raised_fist: ‚úä
:raised_hand: ‚úã
:raising_hands: üôå
:red_exclamation_mark: ‚ùó
:red_heart: ‚ù§
:red_question_mark: ‚ùì
:relieved_face: üòå
:revolving_hearts: üíû
:right_facing_fist: ü§ú
:robot: ü§ñ
:rolling_on_the_floor_laughing: ü§£
:rose: üåπ
:sad_but_relieved_face: üò•
:sailboat: ‚õµ
:scissors: ‚úÇ
:scroll: üìú
:see_no_evil_monkey: üôà
:selfie: ü§≥
:sheaf_of_rice: üåæ
:shushing_face: ü§´
:sign_of_the_horns: ü§ò
:skull: üíÄ
:sleeping_face: üò¥
:sleepy_face: üò™
:slightly_frowning_face: üôÅ
:slightly_smiling_face: üôÇ
:small_airplane: üõ©
:smiling_cat_with_heart_eyes: üòª
:smiling_face_with_halo: üòá
:smiling_face_with_heart_eyes: üòç
:smiling_face_with_horns: üòà
:smiling_face_with_smiling_eyes: üòä
:smiling_face_with_sunglasses: üòé
:smiling_face_with_tear: üí©
:smirking_face: üòè
:snake: üêç
:sneezing_face: ü§ß
:soccer_ball: ‚öΩ
:socialdist: ‚úñÔ∏è
:softball: ‚öΩ
:sparkles: ‚ú®
:sparkling_heart: üíñ
:speaking_head: üó£
:speak_no_evil_monkey: üôä
:spouting_whale: üê≥
:squinting_face_with_tongue: üòù
:squinting_face_with_tongue: üòù
:star_struck: ü§©
:sun: ‚òÄ
:sweat_droplets: üí¶
:syringe: üíâ
:tangerine: üçä
:test_tube: üß™
:thermometer: üå°
:thinking_face: ü§î
:thought_balloon: üí≠
:thumbs_up: üëç
:toilet: üöΩ
:triangular_ruler: üìê
:trident_emblem: üî±
:tulip: üå∑
:turtle: üê¢
:two_hearts: üíï
:unamused_face: üòí
:upside_down_face: üôÉ
:v: ‚úå
:victory_hand: ‚úå
:warning: ‚ö†
:washhands: üí©
:water_pistol: üî´
:water_wave: üåä
:waving_hand: üëã
:weary_cat: üôÄ
:weary_face: üò©
:white_exclamation_mark: ‚ùï
:winking_face: üòâ
:winking_face_with_tongue: üòú
:woman_cartwheeling: ü§∏‚Äç‚ôÄÔ∏è
:woman_dancing: üíÉ
:woman_in_lotus_position: üßò‚Äç‚ôÄ
:woman_raising_hand: üôã‚Äç‚ôÄ
:womans_sandal: üë°
:woozy_face: üí©
:yougotthis: üí©
:yt: ‚ñ∂Ô∏è
:zany_face: ü§™
:zzz: üò¥
EOF
fi

zenity --info --text "ACABOU"

fi
#FIM DO SCRIPT


#Converter o arquivo .json para xls no site
 
#https://www.convertcsv.com/json-to-csv.htm
